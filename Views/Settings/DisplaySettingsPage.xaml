<UserControl x:Class="WWXMapEditor.Views.Settings.DisplaySettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WWXMapEditor.Views.Settings"
             xmlns:scaling="clr-namespace:WWXMapEditor.UI.Scaling"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200">

    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0"
                   Text="DISPLAY SETTINGS" 
                   Foreground="{DynamicResource ForegroundBrush}" 
                   FontFamily="Consolas"
                   FontWeight="Bold" 
                   Margin="{DynamicResource MarginLarge}">
            <TextBlock.FontSize>
                <Binding Source="{x:Static scaling:ScaleService.Instance}"
                         Path="FontScale"
                         Converter="{StaticResource MultiplyConverter}"
                         ConverterParameter="{StaticResource BaseFontSizeXXLarge}"/>
            </TextBlock.FontSize>
        </TextBlock>

        <!-- Arrange sections in two columns: Window + Tooltips | UI Scale -->
        <UniformGrid Grid.Row="1" Columns="2" HorizontalAlignment="Stretch" Margin="{DynamicResource MarginLarge}">
            <!-- Left column stack: Window + Tooltips -->
            <StackPanel Margin="0,0,12,0">
                <!-- Window Section -->
                <GroupBox Header="Window" Style="{StaticResource SettingsGroupBoxStyle}" Margin="0,0,0,12">
                    <StackPanel>
                        <CheckBox Content="Start in fullscreen" 
                                  IsChecked="{Binding StartInFullscreen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  Style="{StaticResource SettingsCheckBoxStyle}"/>

                        <CheckBox Content="Remember window position" 
                                  IsChecked="{Binding RememberWindowPosition, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  Style="{StaticResource SettingsCheckBoxStyle}"
                                  Margin="{DynamicResource MarginMedium}"/>

                        <Grid Margin="{DynamicResource MarginMedium}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Multi-monitor:" 
                                       Foreground="{DynamicResource ForegroundBrush}" 
                                       FontSize="{DynamicResource FontSizeMedium}"
                                       VerticalAlignment="Center"
                                       Margin="{DynamicResource MarginMedium}"/>

                            <ComboBox Grid.Column="1" 
                                      SelectedItem="{Binding MultiMonitorBehavior, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                      ItemsSource="{Binding MultiMonitorBehaviors}"
                                      Style="{StaticResource SettingsComboBoxStyle}"
                                      HorizontalAlignment="Stretch"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- Tooltips Section -->
                <GroupBox Header="Tooltips" Style="{StaticResource SettingsGroupBoxStyle}">
                    <StackPanel>
                        <CheckBox Content="Show tooltips" 
                                  IsChecked="{Binding ShowTooltips, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  Style="{StaticResource SettingsCheckBoxStyle}"/>

                        <Grid Margin="{DynamicResource MarginMedium}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Delay (ms):" 
                                       Foreground="{DynamicResource ForegroundBrush}" 
                                       FontSize="{DynamicResource FontSizeMedium}"
                                       VerticalAlignment="Center"
                                       Margin="{DynamicResource MarginMedium}"/>

                            <Slider Grid.Column="1" 
                                    Minimum="0" 
                                    Maximum="2000" 
                                    Value="{Binding TooltipDelay, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    TickFrequency="100"
                                    IsSnapToTickEnabled="True"
                                    IsEnabled="{Binding ShowTooltips}"
                                    Margin="{DynamicResource MarginMedium}"/>

                            <TextBlock Grid.Column="2" 
                                       Text="{Binding TooltipDelay}" 
                                       Foreground="{DynamicResource ForegroundBrush}" 
                                       FontSize="{DynamicResource FontSizeMedium}"
                                       Width="50"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>
            </StackPanel>

            <!-- Right column: UI Scale -->
            <GroupBox Header="UI Scale" Style="{StaticResource SettingsGroupBoxStyle}" Margin="12,0,0,0">
                <StackPanel>
                    <!-- Scale Mode -->
                    <Grid Margin="{DynamicResource MarginMedium}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Scaling mode:" 
                                   Foreground="{DynamicResource ForegroundBrush}" 
                                   FontSize="{DynamicResource FontSizeMedium}"
                                   VerticalAlignment="Center"
                                   Margin="{DynamicResource MarginMedium}"/>

                        <ComboBox Grid.Column="1"
                                  SelectedItem="{Binding ScaleMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  ItemsSource="{Binding ScaleModes}"
                                  Style="{StaticResource SettingsComboBoxStyle}"
                                  HorizontalAlignment="Stretch"/>
                    </Grid>

                    <!-- Legacy Percent UI (visible only when ScaleMode == LegacyPercent) -->
                    <Grid Margin="{DynamicResource MarginMedium}">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ScaleMode}" Value="LegacyPercent">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="UI scaling (%):" 
                                   Foreground="{DynamicResource ForegroundBrush}" 
                                   FontSize="{DynamicResource FontSizeMedium}"
                                   VerticalAlignment="Center"
                                   Margin="{DynamicResource MarginMedium}"/>

                        <ComboBox Grid.Column="1" 
                                  SelectedItem="{Binding UIScaling, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  ItemsSource="{Binding UIScalings}"
                                  Style="{StaticResource SettingsComboBoxStyle}"
                                  HorizontalAlignment="Stretch"/>
                    </Grid>

                    <!-- Custom Fixed UI (visible only when ScaleMode == CustomFixed) -->
                    <Grid Margin="{DynamicResource MarginMedium}">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ScaleMode}" Value="CustomFixed">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Custom scale:" 
                                   Foreground="{DynamicResource ForegroundBrush}" 
                                   FontSize="{DynamicResource FontSizeMedium}"
                                   VerticalAlignment="Center"
                                   Margin="{DynamicResource MarginMedium}"/>

                        <Slider Grid.Column="1"
                                Minimum="0.5"
                                Maximum="2.0"
                                TickFrequency="0.05"
                                IsSnapToTickEnabled="True"
                                Value="{Binding CustomFixedScale, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                Margin="{DynamicResource MarginMedium}"/>

                        <TextBlock Grid.Column="2"
                                   Text="{Binding CustomFixedScale, StringFormat={}{0:0.00}x}"
                                   Foreground="{DynamicResource AccentBrush}"
                                   FontSize="{DynamicResource FontSizeMedium}"
                                   VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Advanced thresholds -->
                    <Expander Header="Advanced scaling thresholds" Margin="{DynamicResource MarginMedium}">
                        <StackPanel>
                            <Grid Margin="{DynamicResource MarginSmall}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Min auto scale:" Foreground="{DynamicResource ForegroundBrush}" FontSize="{DynamicResource FontSizeMedium}" VerticalAlignment="Center" Margin="{DynamicResource MarginSmall}"/>
                                <TextBox Grid.Column="1" Text="{Binding MinAutoScale, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.00}}" Style="{StaticResource SettingsTextBoxStyle}" />
                            </Grid>
                            <Grid Margin="{DynamicResource MarginSmall}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Max auto scale:" Foreground="{DynamicResource ForegroundBrush}" FontSize="{DynamicResource FontSizeMedium}" VerticalAlignment="Center" Margin="{DynamicResource MarginSmall}"/>
                                <TextBox Grid.Column="1" Text="{Binding MaxAutoScale, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.00}}" Style="{StaticResource SettingsTextBoxStyle}" />
                            </Grid>

                            <Grid Margin="{DynamicResource MarginSmall}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Design width:" Foreground="{DynamicResource ForegroundBrush}" FontSize="{DynamicResource FontSizeMedium}" VerticalAlignment="Center" Margin="{DynamicResource MarginSmall}"/>
                                <TextBox Grid.Column="1" Text="{Binding DesignWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBoxStyle}" />
                            </Grid>
                            <Grid Margin="{DynamicResource MarginSmall}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Design height:" Foreground="{DynamicResource ForegroundBrush}" FontSize="{DynamicResource FontSizeMedium}" VerticalAlignment="Center" Margin="{DynamicResource MarginSmall}"/>
                                <TextBox Grid.Column="1" Text="{Binding DesignHeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SettingsTextBoxStyle}" />
                            </Grid>

                            <Grid Margin="{DynamicResource MarginSmall}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Min font scale:" Foreground="{DynamicResource ForegroundBrush}" FontSize="{DynamicResource FontSizeMedium}" VerticalAlignment="Center" Margin="{DynamicResource MarginSmall}"/>
                                <TextBox Grid.Column="1" Text="{Binding MinFontScale, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.00}}" Style="{StaticResource SettingsTextBoxStyle}" />
                            </Grid>
                            <Grid Margin="{DynamicResource MarginSmall}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Max font scale:" Foreground="{DynamicResource ForegroundBrush}" FontSize="{DynamicResource FontSizeMedium}" VerticalAlignment="Center" Margin="{DynamicResource MarginSmall}"/>
                                <TextBox Grid.Column="1" Text="{Binding MaxFontScale, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.00}}" Style="{StaticResource SettingsTextBoxStyle}" />
                            </Grid>
                        </StackPanel>
                    </Expander>

                    <!-- Font size preference (maps to FontScaleOverride) -->
                    <Grid Margin="{DynamicResource MarginMedium}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Font size preference:" 
                                   Foreground="{DynamicResource ForegroundBrush}" 
                                   FontSize="{DynamicResource FontSizeMedium}"
                                   VerticalAlignment="Center"
                                   Margin="{DynamicResource MarginMedium}"/>

                        <ComboBox Grid.Column="1" 
                                  SelectedItem="{Binding FontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  ItemsSource="{Binding FontSizes}"
                                  Style="{StaticResource SettingsComboBoxStyle}"
                                  HorizontalAlignment="Stretch"/>
                    </Grid>
                </StackPanel>
            </GroupBox>
        </UniformGrid>
    </Grid>
</UserControl>
<UserControl x:Class="WWXMapEditor.Views.NewMapSteps.PlayerSelect.Step4Player3View"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:WWXMapEditor.Converters"
             x:Name="Root">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../PlayerSelectSharedResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <conv:CountryAvailabilityConverter x:Key="CountryAvailabilityConverter"/>
            <conv:CountryClaimedByConverter x:Key="CountryClaimedByConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Border Style="{StaticResource CardBorderStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Row 0: countries -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Player 3" Style="{StaticResource PlayerHeader}"/>

                <ListBox Grid.Column="1"
                         ItemsSource="{StaticResource CountryOptions}"
                         SelectedItem="{Binding ParentViewModel.Player3Country, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.VerticalScrollBarVisibility="Disabled"
                         BorderThickness="0"
                         Background="{x:Null}">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="2" Columns="4"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemContainerStyle>
                        <Style BasedOn="{StaticResource CountryTileContainerBaseStyle}" TargetType="ListBoxItem">
                            <Setter Property="IsEnabled">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource CountryAvailabilityConverter}">
                                        <Binding />
                                        <Binding Path="ParentViewModel.Player3Country"/>
                                        <Binding Path="ParentViewModel.Player1Country"/>
                                        <Binding Path="ParentViewModel.Player2Country"/>
                                        <Binding Path="ParentViewModel.Player4Country"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="ToolTip">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource CountryClaimedByConverter}">
                                        <Binding />
                                        <Binding Path="ParentViewModel.Player1Country"/>
                                        <Binding Path="ParentViewModel.Player2Country"/>
                                        <Binding Path="ParentViewModel.Player3Country"/>
                                        <Binding Path="ParentViewModel.Player4Country"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>

                <!-- swatch -->
                <Border Grid.Column="2" Width="24" Height="24" CornerRadius="3" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" Margin="10,0,0,0" VerticalAlignment="Top">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Background" Value="{x:Null}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3Country}" Value="Redonia">
                                    <Setter Property="Background" Value="{DynamicResource CountryRedoniaBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3Country}" Value="Sevaria">
                                    <Setter Property="Background" Value="{DynamicResource CountrySevariaBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3Country}" Value="Auria">
                                    <Setter Property="Background" Value="{DynamicResource CountryAuriaBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3Country}" Value="Maritain">
                                    <Setter Property="Background" Value="{DynamicResource CountryMaritainBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3Country}" Value="Norvos">
                                    <Setter Property="Background" Value="{DynamicResource CountryNorvosBrush}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3Country}" Value="Valtro">
                                    <Setter Property="Background" Value="{DynamicResource CountryValtroBrush}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
            </Grid>

            <!-- Row 1: toggle below -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="120,10,0,0">
                <CheckBox
                    IsChecked="{Binding ParentViewModel.Player3IsAlly, Mode=TwoWay}"
                    VerticalAlignment="Center"
                    Margin="0,0,10,0">
                    <CheckBox.Template>
                        <ControlTemplate TargetType="CheckBox">
                            <Border x:Name="ToggleBackground"
                                    Width="64" Height="32"
                                    Background="{DynamicResource Surface3Brush}"
                                    CornerRadius="16"
                                    Cursor="Hand">
                                <Grid>
                                    <Ellipse x:Name="ToggleCircle"
                                             Width="28" Height="28"
                                             Fill="{DynamicResource ForegroundBrush}"
                                             HorizontalAlignment="Left" Margin="2,2,0,2">
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform x:Name="ToggleTransform" X="0"/>
                                        </Ellipse.RenderTransform>
                                        <Ellipse.Effect>
                                            <DropShadowEffect Color="{DynamicResource ShadowColor}" BlurRadius="8" ShadowDepth="1" Opacity="0.35"/>
                                        </Ellipse.Effect>
                                    </Ellipse>
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="ToggleBackground" Property="Background" Value="{DynamicResource AccentBrush}"/>
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ToggleTransform" Storyboard.TargetProperty="X" To="32" Duration="0:0:0.18"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ToggleTransform" Storyboard.TargetProperty="X" To="0" Duration="0:0:0.18"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </CheckBox.Template>
                </CheckBox>

                <TextBlock VerticalAlignment="Center" FontFamily="Consolas" FontWeight="Bold">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="Enemy"/>
                            <Setter Property="Foreground" Value="{DynamicResource ForegroundSecondaryBrush}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ParentViewModel.Player3IsAlly}" Value="True">
                                    <Setter Property="Text" Value="Ally"/>
                                    <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>